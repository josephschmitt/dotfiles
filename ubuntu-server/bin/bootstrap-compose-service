#!/bin/bash
set -e

if [ -z "$1" ]; then
  echo "Usage: $0 <project-name>"
  echo "Example: $0 hbojoe"
  exit 1
fi

project_name="$1"
script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
template_path="$script_dir/docker-compose@.service"

echo "Setting up systemd service for $project_name..."

if [ ! -f "$template_path" ]; then
  echo "Error: docker-compose@.service not found at $template_path"
  exit 1
fi

echo "Copying systemd service template..."
sudo cp "$template_path" /etc/systemd/system/

echo "Reloading systemd daemon..."
sudo systemctl daemon-reload

echo "Enabling docker-compose@$project_name.service..."
sudo systemctl enable docker-compose@$project_name.service

echo "Starting docker-compose@$project_name.service..."
sudo systemctl start docker-compose@$project_name.service

echo ""
echo "Service status:"
sudo systemctl status docker-compose@$project_name.service --no-pager

echo ""
echo "âœ“ Bootstrap complete!"
echo "  Service will now start automatically on boot"
