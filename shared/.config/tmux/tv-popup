#!/bin/sh
# Extensible television popup wrapper for tmux
# Usage: tv-popup [TV_OPTIONS] [CHANNEL] [CHANNEL_ARGS...]
#
# This script wraps television (tv) to work seamlessly in tmux popups.
# It provides a standardized interface for launching tv channels in popups
# with consistent sizing and behavior.
#
# Examples:
#   tv-popup files
#   tv-popup sesh
#   tv-popup text
#   tv-popup --inline files
#   tv-popup --preview-size 70 text

set -e

# Use tmux-popup script for consistent popup sizing
# Default to 'medium' size which works well for most tv channels
POPUP_SIZE="${TV_POPUP_SIZE:-medium}"
POPUP_TITLE="${TV_POPUP_TITLE:-Television}"

# Check if we should use inline mode based on TV flags
INLINE_MODE=""
for arg in "$@"; do
    case "$arg" in
        --inline|--height)
            INLINE_MODE="1"
            break
            ;;
    esac
done

# Get the config directory
CONFIG_DIR="${XDG_CONFIG_HOME:-$HOME/.config}/tmux"

# If inline mode is requested, just run tv directly
if [ -n "$INLINE_MODE" ]; then
    exec tv "$@"
fi

# Otherwise, launch in a popup
exec "$CONFIG_DIR/tmux-popup" \
    -s "$POPUP_SIZE" \
    -t "$POPUP_TITLE" \
    -E \
    tv "$@"
