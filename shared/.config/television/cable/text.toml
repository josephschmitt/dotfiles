# Television channel for text search (ripgrep integration)
# Community channel: https://github.com/alexpasmantier/television-channels

[metadata]
name = "text"
description = "A channel to find and select text from files"
requirements = ["rg", "bat"]

[source]
command = "rg . --no-heading --line-number --colors 'match:fg:white' --colors 'path:fg:blue' --color=always"
ansi = true
output = "{strip_ansi|split:\\::..2}"

[preview]
command = "bat -n --color=always '{strip_ansi|split:\\::0}'"
env = { BAT_THEME = "ansi" }
offset = '{strip_ansi|split:\\::1}'

[ui]
preview_panel = { header = '{strip_ansi|split:\\::..2}' }

[keybindings]
enter = "actions:edit_at_line"

[actions.edit_at_line]
description = "Opens the file at the matched line in the default editor"
command = "popup-aware-editor '+{strip_ansi|split:\\::1}' '{strip_ansi|split:\\::0}'"
# Fork mode allows script to properly close popup without crashing tmux
mode = "fork"
